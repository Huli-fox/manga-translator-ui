# v2.0.4 更新日志

发布日期：2026-01-04

## 🐛 修复

- 修复特殊模式（仅上色、仅超分、仅修复）保存JSON时无法获取图片尺寸的问题
- 修复替换翻译模式下不生成 `inpainted.png` 调试图的问题
- 修复替换翻译模式下翻译图蒙版为空时的错误处理

## ✨ 优化

- **替换翻译模式 - 直接粘贴优化**：
  - 移除重复的擦除操作（inpainting 已经擦除过，不需要二次涂白）
  - 改用翻译图的原始蒙版定义粘贴范围（更准确覆盖翻译文字区域）
  - 蒙版扩大20像素，确保完整覆盖文字边缘
  - 简化膨胀逻辑，直接使用原始蒙版，避免过度扩张

- **并行流水线图片类型优化**：
  - 统一使用 PIL Image 格式处理 colorizer/upscaler 输出
  - 最后统一调用 `load_image` 转换为 numpy，与主翻译器保持一致
  - 正确清理 PIL Image 资源（调用 close() 方法），优化内存管理

- **替换翻译模式 - 蒙版筛选优化**：
  - 新增智能蒙版筛选：只保留与匹配区域有交集的蒙版连通区域
  - 先膨胀蒙版（长边3%）检测连通性，再筛选相关区域
  - 避免无关区域的蒙版影响最终合成结果

- **气泡检测功能增强**：
  - 启用高级气泡检测方法（基于边界分析，精度更高）
  - 在 OCR 基类中添加通用气泡过滤方法，支持传入完整图像和坐标
  - 所有 OCR 模型自动使用高级检测方法
  - 优化阈值映射：原先的 0.5 映射到 0.8，推荐使用 0.8 作为默认值
  - 扩大阈值范围，增加区分度（white_threshold: 0.55-0.99, checkset: 1.0-4.0）
  - 修复阈值范围检查（统一为 0-1 浮点数）
