# v1.9.4 更新日志

发布日期：2025-12-09

## 🎉 新功能

### 输出目录优化
- **原图目录输出**：新增选项支持将翻译结果输出到原图片所在目录的 `manga_translator_work/result` 子目录
- 方便管理和查找翻译后的图片

### CLI 本地模式增强
- **内存重启机制**：CLI 的 local 模式添加了内存监控和自动重启机制
- 当内存使用超过阈值时自动重启子进程，避免长时间运行导致的内存溢出
- 支持配置内存阈值和检查间隔

### 文本渲染增强
- **水平文本居中**：添加了水平文本居中对齐支持
- 改进文本在气泡框内的布局效果

### 图片格式支持
- **AVIF 格式**：新增 AVIF 图片格式的输入和输出支持

## ⚡ 优化

### 编辑器性能优化
- **异步图片加载**：使用线程池异步加载图片数据，避免 UI 卡顿
- **异步布局计算**：文本布局计算移至后台线程执行
- **PyQt 信号机制**：使用 PyQt 信号确保线程安全的 UI 更新
- 大幅减少编辑器"未响应"的情况

### 代码清理
- 清理了大量调试日志，减少控制台输出噪音
- 优化了代码结构和错误处理

## 🐛 Bug 修复

### 编辑器
- **修复变量未定义错误**：修复了 `graphics_items.py` 中的变量作用域问题
- **修复导出检测逻辑**：改进了切换图片时的未导出更改检测机制

---

## 升级说明

### 输出到原图目录
1. 在设置中启用"输出到原图目录"选项
2. 翻译结果将保存到 `原图目录/manga_translator_work/result/`

### CLI 内存重启配置
```bash
# 设置内存阈值（默认 80%）
python -m manga_translator local --memory-threshold 80

# 设置检查间隔（默认 60 秒）
python -m manga_translator local --memory-check-interval 60
```
